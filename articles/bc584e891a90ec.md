---
title: "Next.jsãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é–‹ç™ºï¼’"
emoji: "ğŸŒŸ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["python", "django"]
published: false
---

# å®Ÿè¡Œç’°å¢ƒ

- Windows10
- PyCharm(æ—¥æœ¬èªåŒ–æ¸ˆ)
- Python
- Django
- Django Restframework

# ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```shell
> pip install Django
> pip install djangorestframework
> pip install django-cors-headers
> pip install djoser
> pip install djangorestframework-simplejwt
> pip install django-environ
> pip install dj-database-url
```

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

```shell:ã‚¿ãƒ¼ãƒŸãƒŠãƒ«
pip freeze > requirements.txt
```

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«(setting.py)ãªã©ã€è‡ªå‹•çš„ã«ä½œæˆã•ã‚Œã¾ã™ã€‚

```shell
> django-admin startproject [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå]
```

```shell
> django-admin startproject task
```

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ

```shell
> django-admin startapp [ã‚¢ãƒ—ãƒªå]
```

```shell
> django-admin startapp api
```

# ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒèµ·å‹•è¨­å®š(PyCharm ã®å ´åˆ)

manage.py ã‚’å³ã‚¯ãƒªãƒƒã‚¯ â†’ã€Œå®Ÿè¡Œã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã€‚

http://127.0.0.1:8000/ ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ Django ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç”»é¢ãŒèµ·å‹•ã™ã‚‹äº‹ã‚’ç¢ºèªã™ã‚‹ã€‚

# setting.py ã®ç·¨é›†

```diff py
from pathlib import Path
import os
+ import environ
+ from datetime import timedelta

# Build paths inside the project like this: BASE_DIR / 'subdir'.
BASE_DIR = Path(__file__).resolve().parent.parent

+ env = environ.Env()
+ env.read_env(os.path.join(BASE_DIR, '.env'))
```

SECRET_KEY ã¯ github ã§å…¬é–‹ã—ãªã„ã‚ˆã†ã«ç’°å¢ƒå¤‰æ•°ã«æŒãŸã›ãŸå€¤ã‚’è¨­å®šã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
è¨­å®šã™ã‚‹æ–‡å­—ã¯ãƒ©ãƒ³ãƒ€ãƒ ãªæ–‡å­—åˆ—ã¨ã—ã¦ä¸‹ã•ã„ã€‚

```diff py
# SECURITY WARNING: keep the secret key used in production secret!
-SECRET_KEY = 'rz-k-y6g^%pr$0og+j%8wqd3%c_@4a8_-*xgmgz%29m!f9o2k_'
+SECRET_KEY=env('SECRET_KEY')
```

é–‹ç™ºæ™‚ã¨æœ¬ç•ªç’°å¢ƒã§è¨­å®šå€¤ã‚’å¤‰æ›´ã—ãŸã„ã®ã§ã€ç’°å¢ƒå¤‰æ•°ã«æŒãŸã›ã¾ã™ã€‚
é–‹ç™ºç’°å¢ƒï¼šTreuã€æœ¬ç•ªç’°å¢ƒï¼šFalse

```diff py
# SECURITY WARNING: don't run with debug turned on in production!
- DEBUG = True
+ DEBUG = env('DEBUG')
```

é–‹ç™ºæ™‚ã¨æœ¬ç•ªç’°å¢ƒã§è¨­å®šå€¤ã‚’å¤‰æ›´ã—ãŸã„ã®ã§ã€ç’°å¢ƒå¤‰æ•°ã«æŒãŸã›ã¾ã™ã€‚
ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒï¼š127.0.0.1ã€æœ¬ç•ªç’°å¢ƒï¼šãƒ‰ãƒ¡ã‚¤ãƒ³

```diff py
- ALLOWED_HOSTS = []
+ ALLOWED_HOSTS = env.list('ALLOWED_HOST')
```

```diff py
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
+   'rest_framework',            # djangorestframeworkã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã®è¨˜è¿°ã§ã™
+   'api.apps.ApiConfig',        # è¨˜è¼‰æ–¹æ³•ã¯å¾Œè¿°ã—ã¾ã™ã€‚
+   'corsheaders',               # django-cors-headersã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã®è¨˜è¿°ã§ã™
+   'djoser',                    # djoserã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã®è¨˜è¿°ã§ã™
]
MIDDLEWARE = [
+   'corsheaders.middleware.CorsMiddleware',  # django-cors-headersã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã®è¨˜è¿°ã§ã™
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
    'django_structlog.middlewares.RequestMiddleware',
]
```

`CORS_ORIGIN_WHITELIST`ã«ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å´ã® URL ã‚’è¨˜è¿°ã—ã¾ã™ã€‚
ä¾‹ï¼šhttp://localhost:3000
é–‹ç™ºæ™‚ã¨æœ¬ç•ªç’°å¢ƒã§è¨­å®šå€¤ã‚’å¤‰æ›´ã—ãŸã„ã®ã§ã€ç’°å¢ƒå¤‰æ•°ã«æŒãŸã›ã¾ã™ã€‚

```diff py
+CORS_ORIGIN_WHITELIST = env.list('CORS_ORIGIN_WHITELIST')
```

`DEFAULT_PERMISSION_CLASSES` ã¯ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®šã—ã¾ã™ã€‚
djangorestframework ã«ã¦ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚[å…¬å¼ãƒšãƒ¼ã‚¸](https://www.django-rest-framework.org/api-guide/permissions/#setting-the-permission-policy)
ä¸‹è¨˜ã®è¨­å®šã‚’è¨˜è¿°ã™ã‚‹äº‹ã§ã€ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚
â€»ä»Šå›ã®ä¾‹ã¯ã€ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶è‡ªèº«ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«
ã€€ã™ã‚‹å¯¾å¿œã‚’è¡Œã†ãŸã‚ã€DEFAULT_PERMISSION_CLASSES ã®è¨­å®šã‚’ã—ãªãã¦ã‚‚
ã€€å½±éŸ¿ã‚ã‚Šã¾ã›ã‚“ã€‚

`DEFAULT_AUTHENTICATION_CLASSES` ã¯èªè¨¼ã‚¹ã‚­ãƒ¼ãƒ ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®šã—ã¾ã™ã€‚
[å…¬å¼ãƒšãƒ¼ã‚¸](https://www.django-rest-framework.org/api-guide/authentication/#setting-the-authentication-scheme)
ä¸‹è¨˜ã®è¨­å®šã‚’ã™ã‚‹äº‹ã§ã€èªè¨¼ã« djangorestframework-simplejwt ã‚’ä½¿ç”¨ã™ã‚‹è¨­å®šã¨ãªã‚Šã¾ã™ã€‚
[å…¬å¼ãƒšãƒ¼ã‚¸](https://django-rest-framework-simplejwt.readthedocs.io/en/latest/experimental_features.html)

```diff py
+REST_FRAMEWORK = {
+   'DEFAULT_PERMISSION_CLASSES': [
+        'rest_framework.permissions.IsAuthenticated',
+    ],
+    'DEFAULT_AUTHENTICATION_CLASSES': [
+        'rest_framework_simplejwt.authentication.JWTAuthentication',
+    ],
+}
```

ãƒˆãƒ¼ã‚¯ãƒ³ã®æŒç¶šæ™‚é–“ã®è¨­å®š

```diff py
+SIMPLE_JWT = {
+    'AUTH_HEADER_TYPES':('JWT',),
+    'ACCESS_TOKEN_LIFETIME': timedelta(minutes=1200)
+}
```

# å‹•ä½œç¢ºèª

- http://127.0.0.1:8000/
  - Django ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã€‚
