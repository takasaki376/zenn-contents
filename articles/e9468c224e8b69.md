---
title: "Hyper-VにMIRACLE LINUX 8インストール"
emoji: "🎉"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["linux"]
published: false
---

# 概要

Windows10 Pro の Hyper-V の機能を使用して Linux をインストールします。
Linux は、CentOS の後継 OS として MIRACLE LINUX 8.4 を使います。

# Hyper-V の有効化

Nicrosoft の[公式ページ](https://docs.microsoft.com/ja-jp/virtualization/hyper-v-on-windows/quick-start/enable-hyper-v)から下記の手順で有効化します。

## PowerShell を使用して Hyper-V を有効にする

```PowerShell
Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V -All
```

## 設定で Hyper-V ロールを有効にする

1． Windows ボタンを右クリックし、`アプリと機能`を選択します。
1． 右側の関連する設定にある `プログラムと機能`を選択します。
1． `Windows の機能の有効化または無効化`を選択します。
1． `Hyper-V` を選択して、`OK` をクリックします。

# MIRACLE LINUX 8.4 ダウンロード

[こちら](https://www.cybertrust.co.jp/miraclelinux-license-free/)の公式ページから iso ファイルをダウンロードします。

- 画像１

ダウンロードボタンをクリックすると下記のページが開くため、`8.4-released/`　 ⇒ 　`x86_64/`とクリックして iso ファイルをダウンロードして下さい。

- 画像２、３

ダウンロードしたファイルや約 9.3GB あります。

- 画像４

# 仮想マシンを作成

Hyper-V を起動して、MIRACLE LINUX で稼働する仮想マシンを作成します。
`スタートメニュー` ⇒ `Windows管理ツール` ⇒ `Hyper-Vマネージャー`

- 画像５

Hyper-V マネージャーが起動したら、左側のコンピューター名を選択し、`操作` ⇒ `新規` ⇒ `仮想マシン`を選択してください。

- 画像６

右側にある`新規` ⇒ `仮想マシン`でも構いません。

- 画像７

`次へ`をクリックしてください。

- 画像８

後で Hyper-V に表示される名前を入力します。
わかりやすい名前を設定し`次へ`をクリックします。
※仮想マシンのデータを格納する場所が分かりにくいため、`C:\ProgramData\Microsoft\Windows\Hyper-V\` ⇒ `C:\Hyper-V\`に変更しています。必須ではありませんので、変更する場合は任意の場所を指定してください。

- 画像９

`第２世代`を選択し、`次へ`をクリックします。

- 画像１０

メモリは後から変更可能ですが、４ＧＢで設定します。
`次へ`をクリックします。

- 画像１１

ネットワークの設定も後から変更可能です。
とりあえずは、`Default Switch`を選択し、`次へ`をクリックします。

- 画像１２

ハードディスクのサイズを指定します。

- 画像１３

`ブートイメージファイルからオペレーティングシステムをインストールする`を選択し、ダウンロードした MIRACLE LINUX の iso ファイルを指定します。

- 画像１４

`完了`をクリックします。

- 画像１５

`仮想マシン`の一覧に仮想マシンが停止した状態で作成されました。

- 画像１６

# MIRACLE LINUX セットアップ

## 起動時の設定変更

作成した仮想マシンを選択し、`右クリック` ⇒ `設定`をクリックします。

- 画像１７

`セキュアブートを有効にする`のチェックをＯＦＦにし、`ＯＫ`をクリックします。

- 画像１８

## MIRACLE LINUX インストール

作成した仮想マシンを選択し、`右クリック` ⇒ `起動`をクリックします。

- 画像１９

作成した仮想マシンを選択し、`右クリック` ⇒ `接続`をクリックします。
仮想マシンの画面が別ウィンドウで開きます。

- 画像２０

`Install MIRACLE LINUX 8.4`を選択し、Enter キーを押下します。

- 画像２１

インストールが開始されるのでしばらく待ちます。

- 画像２２

インストールに使用する言語として日本語を選択します。
下のテキストボックスに`japan`と入力すると、`日本語`が表示されるためクリックし、`続行`をクリックします。

- 画像２３

`インストール先`をクリックします。

- 画像２４

`ディスク`にチェックがついていることを確認し、`完了`をクリックします。

- 画像２５

root ユーザのパスワードを設定するため、`rootパスワード`をクリックします。

- 画像２６

任意のパスワードを入力し、`完了`をクリックします。

- 画像２７

一般ユーザを作成するため、`ユーザの作成`をクリックします。

- 画像２８

ユーザ名、パスワードを入力し、`完了`をクリックします。

- 画像２９

ネットワーク設定を変更するため、`ネットワークとホスト名`をクリックします。

- 画像３０

右上のスイッチをクリックし、`オン`と表示される事を確認し、`完了`をクリックします。

- 画像３１

タイムゾーンを日本に変更する場合は、`時刻と日付`をクリックします。

- 画像３２

日本の辺りをクリックし、地域欄に`アジア`、都市欄に`東京`と表示される事を確認します。
`ネットワーク時刻`のスイッチをクリックし、`オン`と表示される事を確認します。
`完了`をクリックします。

- 画像３３

`インストールの開始`をクリックします。

- 画像３４

インストールが完了するまでしばらく待ちます。

- 画像３５

インストールが完了したら、`システムの再起動`をクリックします。

- 画像３６

再起動後にライセンスに同意する事を求められます。
`ライセンス情報`をクリックします。

- 画像３７

`ライセンス契約に同意します。`にチェックをして`完了`をクリックします。

- 画像３８

`設定の完了`をクリックします。

- 画像３９

# アップデート

## サインイン

作成したユーザーでサインインします。

- 画像４０、４１

日本語にチェックがされている事を確認し、`次へ`をクリックします。

- 画像４２

キーボードのレイアウトの指定です。106 キーボードの場合は`日本語（かな漢字）`が選択されている事を確認し、`次へ`をクリックします。

- 画像４３

位置情報サービスを使用しないため、ＯＦＦにし、`次へ`をクリックします。

- 画像４４

オンラインアカウントの接続は不要であるため、`スキップ`をクリックします。

- 画像４５

設定が終わったので`MIRACLE LINUXを使い始める`をクリックします。

- 画像４６

「初めて使う方へ」が表示されますが、必要なければ閉じます。

- 画像４７

アップデートするために、ターミナルを起動します。
`アクティビティ` ⇒ `端末`をクリックします。

- 画像４８

ターミナルにて、アップデートのコマンドを実行します。

```shell
$ su
パスワード：[rootユーザのパスワードを入力する]
$ dnf update
```

- 画像４９

アップデート対象が表示されるため、`y`を入力し、`Enter`キーを押下する。

- 画像５０

「完了しました！」というメッセージが表示されると完了です。

## ネットワーク設定確認

root ユーザで実行すること

### 現在の設定値確認

```shell
$ ifconfig
eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 172.30.69.234  netmask 255.255.240.0  broadcast 172.30.79.255
        inet6 fe80::215:5dff:fe0c:7600  prefixlen 64  scopeid 0x20<link>
        ether 00:15:5d:0c:76:00  txqueuelen 1000  (Ethernet)
        RX packets 605183  bytes 886479892 (845.4 MiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 216745  bytes 17879133 (17.0 MiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 8  bytes 480 (480.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 8  bytes 480 (480.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

virbr0: flags=4099<UP,BROADCAST,MULTICAST>  mtu 1500
        inet 192.168.122.1  netmask 255.255.255.0  broadcast 192.168.122.255
        ether 52:54:00:cb:b1:78  txqueuelen 1000  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```

### デバイス一覧

```shell
$ nmcli device
DEVICE      TYPE      STATE            CONNECTION
eth0        ethernet  接続済み         eth0
virbr0      bridge    接続済み (外部)  virbr0
lo          loopback  管理無し         --
virbr0-nic  tun       管理無し         --
```

### デバイス設定参照

最後の`eth0`はデバイス名

```shell
$  nmcli device show eth0
GENERAL.DEVICE:                         eth0
GENERAL.TYPE:                           ethernet
GENERAL.HWADDR:                         00:15:5D:0C:76:00
GENERAL.MTU:                            1500
GENERAL.STATE:                          100 (接続済み)
GENERAL.CONNECTION:                     eth0
GENERAL.CON-PATH:                       /org/freedesktop/NetworkManager/ActiveConnection/1
WIRED-PROPERTIES.CARRIER:               オン
IP4.ADDRESS[1]:                         172.30.69.234/20
IP4.GATEWAY:                            172.30.64.1
IP4.ROUTE[1]:                           dst = 0.0.0.0/0, nh = 172.30.64.1, mt = 100
IP4.ROUTE[2]:                           dst = 172.30.64.0/20, nh = 0.0.0.0, mt = 100
IP4.DNS[1]:                             172.30.64.1
IP4.DOMAIN[1]:                          mshome.net
IP6.ADDRESS[1]:                         fe80::215:5dff:fe0c:7600/64
IP6.GATEWAY:                            --
IP6.ROUTE[1]:                           dst = fe80::/64, nh = ::, mt = 100
IP6.ROUTE[2]:                           dst = ff00::/8, nh = ::, mt = 256, table=255
```

```shell
$ nmcli connection show eth0
connection.id:                          eth0
connection.uuid:                        db8435d6-6052-446d-8ed6-5a8a398ee438
connection.stable-id:                   --
connection.type:                        802-3-ethernet
connection.interface-name:              eth0
connection.autoconnect:                 はい
connection.autoconnect-priority:        0
connection.autoconnect-retries:         -1 (default)
connection.multi-connect:               0 (default)
connection.auth-retries:                -1
connection.timestamp:                   1635668722
connection.read-only:                   いいえ
connection.permissions:                 --
connection.zone:                        --
connection.master:                      --
connection.slave-type:                  --
connection.autoconnect-slaves:          -1 (default)
connection.secondaries:                 --
connection.gateway-ping-timeout:        0
connection.metered:                     不明
connection.lldp:                        default
connection.mdns:                        -1 (default)
connection.llmnr:                       -1 (default)
connection.wait-device-timeout:         -1
802-3-ethernet.port:                    --
802-3-ethernet.speed:                   0
802-3-ethernet.duplex:                  --
802-3-ethernet.auto-negotiate:          いいえ
802-3-ethernet.mac-address:             --
```

### DHCP 確認

```shell
$ nmcli connection show eth0 | grep connection.autoconnect
connection.autoconnect:                 はい
connection.autoconnect-priority:        0
connection.autoconnect-retries:         -1 (default)
connection.autoconnect-slaves:          -1 (default)
```

## ネットワーク設定変更

### DHCP 無効化

```shell
$ nmcli connection modify eth0 connection.autoconnect no
$
$ nmcli connection show eth0 | grep connection.autoconnect
connection.autoconnect:                 いいえ
connection.autoconnect-priority:        0
connection.autoconnect-retries:         -1 (default)
connection.autoconnect-slaves:          -1 (default)
```

### 固定 IP アドレス設定

```shell
Shell
# 固定IP 172.30.69.234/20
$ nmcli connection modify eth0 ipv4.address 172.30.69.234/20
# デフォルトゲートウェイ 172.30.64.1
$ nmcli connection modify eth0 ipv4.gateway 172.30.64.1
# dns 172.30.64.1
$ nmcli connection modify eth0 ipv4.dns 172.30.64.1
# デバイスを固定設定　
$ nmcli connection modify eth0 ipv4.method manual
```

### ネットワークデバイス再起動

```shell
# デバイス停止
$ nmcli connection down eth0
# デバイス起動
$ nmcli connection up eth0
# 起動確認
$ nmcli device
DEVICE      TYPE      STATE            CONNECTION
eth0        ethernet  接続済み         eth0
virbr0      bridge    接続済み (外部)  virbr0
lo          loopback  管理無し         --
virbr0-nic  tun       管理無し         --
```
